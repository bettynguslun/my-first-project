<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grand Palace Hotel | Management System</title>
  <style>
    :root {
      --primary: #6366f1;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --gray: #6b7280;
      --light: #f8fafc;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background:var(--light); color:#1e293b; line-height:1.6; }
    header { background:var(--primary); color:white; text-align:center; padding:1.5rem; font-size:1.5rem; }
    nav { background:white; box-shadow:0 4px 6px rgba(0,0,0,0.1); position:sticky; top:0; z-index:100; }
    nav ul { display:flex; flex-wrap:wrap; justify-content:center; list-style:none; }
    nav a { padding:1rem 1.5rem; color:var(--primary); text-decoration:none; font-weight:600; display:block; }
    nav a:hover, nav a.active { background:var(--primary); color:white; }
    .container { max-width:1400px; margin:2rem auto; padding:0 1rem; }
    h2 { margin:2rem 0 1rem; color:var(--primary); text-align:center; }

    .grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(260px,1fr)); gap:1.5rem; margin:2rem 0; }
    .card { background:white; padding:2rem; border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,0.1); text-align:center; transition:0.3s; }
    .card:hover { transform:translateY(-8px); }
    .card h3 { color:var(--gray); font-weight:500; margin-bottom:1rem; }
    .card h1 { font-size:3.5rem; color:var(--primary); }

    .btn { 
      padding:0.8rem 1.6rem; border:none; border-radius:12px; cursor:pointer; 
      font-weight:bold; font-size:1rem; transition:0.3s; margin:0.5rem;
    }
    .btn-primary { background:var(--primary); color:white; }
    .btn-success { background:var(--success); color:white; }
    .btn-danger { background:var(--danger); color:white; }
    .btn-outline { background:transparent; border:2px solid var(--primary); color:var(--primary); }
    .btn:hover { opacity:0.9; transform:scale(1.05); }

    table { width:100%; border-collapse:collapse; background:white; border-radius:12px; overflow:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.08); }
    th { background:var(--primary); color:white; padding:1rem; text-align:left; }
    td { padding:1rem; border-bottom:1px solid #eee; }
    tr:hover { background:#f1f5f9; }

    .modal {
      position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7);
      display:flex; align-items:center; justify-content:center; z-index:1000; padding:1rem;
    }
    .modal-content {
      background:white; width:100%; max-width:550px; border-radius:16px; padding:2rem; max-height:95vh; overflow-y:auto;
    }
    .form-group { margin-bottom:1.2rem; }
    label { display:block; margin-bottom:0.5rem; font-weight:600; color:#374151; }
    input, select { width:100%; padding:0.9rem; border:1px solid #cbd5e1; border-radius:12px; font-size:1rem; }
    .hidden { display:none !important; }

    .quick-actions { text-align:center; margin:2rem 0; }
    .quick-actions .btn { font-size:1.2rem; padding:1rem 2rem; }

    @media (max-width: 768px) {
      header { font-size:1.3rem; padding:1rem; }
      nav a { padding:0.8rem 1rem; font-size:0.95rem; }
      .card h1 { font-size:2.8rem; }
      .modal-content { padding:1.5rem; }
    }
  </style>
</head>
<body>

<header>
  <h1>Grand Palace Hotel - Management System</h1>
</header>

<nav>
  <ul>
    <li><a href="#" class="active" data-page="dashboard">Dashboard</a></li>
    <li><a href="#" data-page="rooms">Rooms</a></li>
    <li><a href="#" data-page="bookings">Bookings</a></li>
    <li><a href="#" data-page="guests">Current Guests</a></li>
  </ul>
</nav>

<div class="container">

  <!-- Dashboard -->
  <div id="dashboard">
    <h2>Welcome Back, Manager!</h2>
    <div class="grid">
      <div class="card"><h3>Total Rooms</h3><h1 id="totalRooms">0</h1></div>
      <div class="card"><h3>Available Now</h3><h1 id="availableRooms" style="color:var(--success)">0</h1></div>
      <div class="card"><h3>Occupied</h3><h1 id="occupiedRooms" style="color:var(--danger)">0</h1></div>
      <div class="card"><h3>Today's Arrivals</h3><h1 id="todayBookings">0</h1></div>
    </div>

    <div class="quick-actions">
      <button class="btn btn-success" onclick="openBookingModal()">+ New Booking</button>
      <button class="btn btn-primary" onclick="openWalkInModal()">Guest Walk-in (Instant)</button>
    </div>
  </div>

  <!-- Rooms -->
  <div id="rooms" class="hidden">
    <div style="text-align:right; margin-bottom:1rem;">
      <button class="btn btn-primary" onclick="openRoomModal()">+ Add New Room</button>
    </div>
    <table id="roomsTable">
      <thead><tr><th>Room No</th><th>Type</th><th>Price/Night</th><th>Status</th><th>Actions</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Bookings -->
  <div id="bookings" class="hidden">
    <div style="text-align:right; margin-bottom:1rem;">
      <button class="btn btn-success" onclick="openBookingModal()">+ New Booking</button>
    </div>
    <table id="bookingsTable">
      <thead><tr><th>ID</th><th>Guest</th><th>Room</th><th>Check-in</th><th>Check-out</th><th>Status</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Current Guests - FIXED! -->
  <div id="guests" class="hidden">
    <h2>Guests Currently Staying</h2>
    <table id="guestsTable">
      <thead><tr><th>Guest Name</th><th>Phone</th><th>Email</th><th>Room</th><th>Check-in Date</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Modals (Room, Booking, Walk-in) -->
<div id="roomModal" class="modal hidden" onclick="if(event.target===this) closeModal('roomModal')">
  <div class="modal-content">
    <h3 id="roomTitle">Add New Room</h3>
    <form id="roomForm">
      <input type="hidden" id="roomId">
      <div class="form-group"><label>Room Number</label><input type="text" id="roomNumber" required placeholder="101"></div>
      <div class="form-group"><label>Type</label>
        <select id="roomType" required>
          <option>Single</option><option>Double</option><option>Suite</option><option>Deluxe</option>
        </select>
      </div>
      <div class="form-group"><label>Price/Night ($)</label><input type="number" id="roomPrice" required min="1"></div>
      <div style="text-align:right;">
        <button type="button" class="btn btn-outline" onclick="closeModal('roomModal')">Cancel</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>

<div id="bookingModal" class="modal hidden" onclick="if(event.target===this) closeModal('bookingModal')">
  <div class="modal-content">
    <h3>New Booking</h3>
    <form id="bookingForm">
      <div class="form-group"><label>Guest Name</label><input type="text" id="guestName" required></div>
      <div class="form-group"><label>Phone</label><input type="text" id="guestPhone" required></div>
      <div class="form-group"><label>Email (optional)</label><input type="email" id="guestEmail"></div>
      <div class="form-group"><label>Room</label><select id="bookingRoom" required></select></div>
      <div class="form-group"><label>Check-in</label><input type="date" id="checkIn" required></div>
      <div class="form-group"><label>Check-out</label><input type="date" id="checkOut" required></div>
      <div style="text-align:right;">
        <button type="button" class="btn btn-outline" onclick="closeModal('bookingModal')">Cancel</button>
        <button type="submit" class="btn btn-success">Create Booking</button>
      </div>
    </form>
  </div>
</div>

<div id="walkinModal" class="modal hidden" onclick="if(event.target===this) closeModal('walkinModal')">
  <div class="modal-content">
    <h3>Guest Walk-in (Instant Check-in)</h3>
    <form id="walkinForm">
      <div class="form-group"><label>Guest Name</label><input type="text" id="guestWalkinName" required></div>
      <div class="form-group"><label>Phone</label><input type="text" id="guestWalkinPhone" required></div>
      <div class="form-group"><label>Assign Room</label><select id="walkinRoom" required></select></div>
      <div style="text-align:right;">
        <button type="button" class="btn btn-outline" onclick="closeModal('walkinModal')">Cancel</button>
        <button type="submit" class="btn btn-success">Check In Now</button>
      </div>
    </form>
  </div>
</div>

<script>
let rooms = JSON.parse(localStorage.getItem('rooms')) || [];
let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
let counter = parseInt(localStorage.getItem('counter')) || 1001;

function closeModal(id) {
  document.getElementById(id).classList.add('hidden');
  document.querySelectorAll('form').forEach(f => f.reset());
}

// Navigation
document.querySelectorAll('nav a').forEach(a => a.addEventListener('click', e => {
  e.preventDefault();
  document.querySelectorAll('nav a').forEach(x => x.classList.remove('active'));
  a.classList.add('active');
  document.querySelectorAll('#dashboard,#rooms,#bookings,#guests').forEach(s => s.classList.add('hidden'));
  document.getElementById(a.dataset.page).classList.remove('hidden');
  updateDashboard();
  if (a.dataset.page === 'rooms') renderRooms();
  if (a.dataset.page === 'bookings') renderBookings();
  if (a.dataset.page === 'guests') renderGuests();   // Fixed here
}));

function openRoomModal(r = null) {
  document.getElementById('roomTitle').textContent = r ? 'Edit Room' : 'Add New Room';
  if (r) {
    document.getElementById('roomId').value = r.number;
    document.getElementById('roomNumber').value = r.number;
    document.getElementById('roomType').value = r.type;
    document.getElementById('roomPrice').value = r.price;
  }
  document.getElementById('roomModal').classList.remove('hidden');
}

function openBookingModal() { populateRooms('bookingRoom'); document.getElementById('bookingModal').classList.remove('hidden'); }
function openWalkInModal() { populateRooms('walkinRoom'); document.getElementById('walkinModal').classList.remove('hidden'); }

function populateRooms(id) {
  const sel = document.getElementById(id);
  sel.innerHTML = '<option value="">-- Select room --</option>';
  const occupied = bookings.filter(b => b.status === 'Checked In').map(b => b.room);
  rooms.filter(r => !occupied.includes(r.number)).forEach(r => {
    sel.innerHTML += `<option value="${r.number}">Room ${r.number} (${r.type}) - $${r.price}/night</option>`;
  });
}

// Save room
document.getElementById('roomForm').onsubmit = e => {
  e.preventDefault();
  const num = document.getElementById('roomNumber').value.trim();
  const old = document.getElementById('roomId').value;
  if (!old && rooms.some(r => r.number === num)) return alert('Room exists!');
  const room = { number: num, type: document.getElementById('roomType').value, price: document.getElementById('roomPrice').value };
  if (old) rooms = rooms.map(r => r.number === old ? room : r);
  else rooms.push(room);
  localStorage.setItem('rooms', JSON.stringify(rooms));
  closeModal('roomModal');
  renderRooms(); updateDashboard();
};

// Normal booking
document.getElementById('bookingForm').onsubmit = e => {
  e.preventDefault();
  const today = new Date().toISOString().split('T')[0];
  const b = {
    id: counter++,
    guestName: document.getElementById('guestName').value,
    guestPhone: document.getElementById('guestPhone').value,
    guestEmail: document.getElementById('guestEmail').value,
    room: document.getElementById('bookingRoom').value,
    checkIn: document.getElementById('checkIn').value,
    checkOut: document.getElementById('checkOut').value,
    status: document.getElementById('checkIn').value <= today ? 'Checked In' : 'Confirmed'
  };
  bookings.push(b);
  localStorage.setItem('bookings', JSON.stringify(bookings));
  localStorage.setItem('counter', counter);
  closeModal('bookingModal');
  renderBookings(); renderGuests(); updateDashboard();
};

// Walk-in
document.getElementById('walkinForm').onsubmit = e => {
  e.preventDefault();
  const b = {
    id: counter++,
    guestName: document.getElementById('guestWalkinName').value,
    guestPhone: document.getElementById('guestWalkinPhone').value,
    guestEmail: '',
    room: document.getElementById('walkinRoom').value,
    checkIn: new Date().toISOString().split('T')[0],
    checkOut: '',
    status: 'Checked In'
  };
  bookings.push(b);
  localStorage.setItem('bookings', JSON.stringify(bookings));
  localStorage.setItem('counter', counter);
  closeModal('walkinModal');
  alert('Guest checked in!');
  renderBookings(); renderGuests(); updateDashboard();
};

function renderRooms() {
  const tbody = document.querySelector('#roomsTable tbody');
  tbody.innerHTML = rooms.map(r => {
    const occ = bookings.some(b => b.room === r.number && b.status === 'Checked In');
    return `<tr><td>${r.number}</td><td>${r.type}</td><td>$${r.price}</td><td>${occ?'Occupied':'Available'}</td><td>
      <button class="btn btn-warning btn-sm" onclick='openRoomModal(${JSON.stringify(r)})'>Edit</button>
      <button class="btn btn-danger btn-sm" onclick="if(confirm('Delete?')){rooms=rooms.filter(x=>x.number!=='${r.number}');bookings=bookings.filter(x=>x.room!=='${r.number}');localStorage.setItem('rooms',JSON.stringify(rooms));localStorage.setItem('bookings',JSON.stringify(bookings));renderRooms();renderBookings();renderGuests();updateDashboard();}">Delete</button>
    </td></tr>`;
  }).join('');
}

function renderBookings() {
  const tbody = document.querySelector('#bookingsTable tbody');
  const today = new Date().toISOString().split('T')[0];
  [...bookings].sort((a,b)=>b.id-a.id).forEach(b => {
    if (b.status==='Confirmed' && b.checkIn<=today) { b.status='Checked In'; localStorage.setItem('bookings',JSON.stringify(bookings)); }
  });
  tbody.innerHTML = bookings.map(b => `
    <tr>
      <td>#${b.id}</td><td>${b.guestName}</td><td>${b.room}</td><td>${b.checkIn}</td><td>${b.checkOut||'-'}</td>
      <td>${b.status}</td>
      <td>
        ${b.status==='Confirmed' ? `<button class="btn btn-primary btn-sm" onclick="b.status='Checked In';localStorage.setItem('bookings',JSON.stringify(bookings));renderBookings();renderGuests();updateDashboard();">Check In</button>` : ''}
        ${b.status==='Checked In' ? `<button class="btn btn-success btn-sm" onclick="if(confirm('Check out?')){b.status='Checked Out';localStorage.setItem('bookings',JSON.stringify(bookings));renderBookings();renderGuests();updateDashboard();}">Check Out</button>` : ''}
      </td>
    </tr>`).join('');
}

// FIXED Current Guests Table
function renderGuests() {
  const tbody = document.querySelector('#guestsTable tbody');
  tbody.innerHTML = '';   // Clear first
  bookings
    .filter(b => b.status === 'Checked In')
    .forEach(b => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><strong>${b.guestName}</strong></td>
        <td>${b.guestPhone}</td>
        <td>${b.guestEmail || '-'}</td>
        <td>Room ${b.room}</td>
        <td>${b.checkIn}</td>
      `;
      tbody.appendChild(tr);
    });
}

function updateDashboard() {
  const occupied = bookings.filter(b => b.status === 'Checked In').length;
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('totalRooms').textContent = rooms.length;
  document.getElementById('availableRooms').textContent = rooms.length - occupied;
  document.getElementById('occupiedRooms').textContent = occupied;
  document.getElementById('todayBookings').textContent = bookings.filter(b => b.checkIn === today).length;
}

// Start
updateDashboard();
renderRooms();
renderBookings();
renderGuests();
</script>
</body>
</html>